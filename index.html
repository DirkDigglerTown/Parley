--- index_original.html+++ index_modified.html@@ -4,43 +4,34 @@   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   <title>Parley Protocol — Multi-Agent LLM Debates</title>
-  <meta name="description" content="Watch AI agents debate deep questions in your browser — no servers, no paid APIs. WebGPU + WebLLM." />
+  <meta name="description" content="Watch AI agents debate deep ...in your browser — no servers, no paid APIs. WebGPU + WebLLM." />
 
   <!-- Favicon & social preview -->
   <link rel="icon" type="image/png" href="favicon.png" />
   <link rel="apple-touch-icon" href="favicon.png" />
   <meta property="og:title" content="Parley Protocol — Multi-Agent LLM Debates" />
-  <meta property="og:description" content="Pose a deep question and watch AI personas debate toward a joint plan — all on your device." />
+  <meta property="og:description" content="Pose a deep question ...AI personas debate toward a joint plan — all on your device." />
   <meta property="og:image" content="https://parleyprotocol.codes/social-preview.png" />
   <meta property="og:url" content="https://parleyprotocol.codes/" />
   <meta property="og:type" content="website" />
-  <meta name="twitter:card" content="summary_large_image" />
-  <meta name="theme-color" content="#05070c" />
-
+
+  <!-- Performance hints -->
   <link rel="preconnect" href="https://esm.run" />
+  <link rel="preconnect" href="https://huggingface.co" />
+  <link rel="preconnect" href="https://raw.githubusercontent.com" />
+
   <style>
     :root{
-      --bg:#05070c; --fg:#e6f1ff; --muted:#9bb0c8; --glass:rgba(255,255,255,.06);
-      --accent:#00e5ff; --accent2:#7c4dff; --good:#00e27b; --warn:#ffd166; --bad:#ff5c8a;
-      --outline:rgba(255,255,255,.10); --ok:#00e27b;
-    }
-    *{box-sizing:border-box;margin:0;padding:0}
-    html,body{height:100%;width:100%}
-    body{
-      font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Arial;
-      color:var(--fg);
-      overflow-x:hidden;
-      background-color:var(--bg);
-      background-image:
-        linear-gradient(180deg, rgba(4,6,12,.88), rgba(4,6,12,.70)),
-        url("Solana-coded UI background.png");
-      background-position:center center;
-      background-size:cover;
-      background-attachment:fixed;
-    }
-    header{
-      position:sticky; top:0; z-index:20;
-      backdrop-filter:saturate(140%) blur(10px);
+      --bg:#0A0E14; --panel:#0E141C; --panel2:#0C1218; --text:#EAF2FF; --muted:#A7B1C2;
+      --accent:#39E5C2; --accent2:#B08CFF; --bad:#FF5C8A; --good:#3BE07D; --outline:#1D2734;
+    }
+    *{box-sizing:border-box} html,body{height:100%}
+    body{margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
+      color:var(--text); background:radial-gradient(1200px 600px at 75% -10%, rgba(80,40,130,.25), transparent),
+      radial-gradient(1200px 600px at 5% 90%, rgba(0,202,170,.18), transparent), var(--bg);}
+    a{color:inherit}
+    .wrap{min-height:100vh; display:flex; flex-direction:column}
+    header{position:sticky; top:0; z-index:2; backdrop-filter:saturate(140%) blur(10px);
       background:linear-gradient(180deg, rgba(10,14,20,.92), rgba(10,14,20,.65));
       border-bottom:1px solid var(--outline);
     }
@@ -52,168 +43,128 @@     .credit a{color:var(--accent)}
     main{position:relative; z-index:1; width:min(1100px,92vw); margin:0 auto; padding:20px 0 80px; display:grid; gap:18px}
 
-    .wgpu-warning{display:none; background:rgba(255,92,138,0.12); border:1px solid var(--bad); color:var(--bad); padding:10px 12px; border-radius:10px; font-size:14px}
+    .wgpu-warning{display:none; background:rgba(255,92,138,0.12); color:#FFBDD0; border:1px solid rgba(255,92,138,0.35); padding:10px 12px; border-radius:10px; font-size:14px}
 
     .hero{position:relative; overflow:hidden; min-height:48vh; border-radius:18px; border:1px solid var(--outline)}
-    .hero video{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; pointer-events:none; filter:contrast(1.08) saturate(1.05) brightness(.9)}
-    .hero-overlay{position:relative; z-index:2; display:flex; flex-direction:column; gap:10px; align-items:center; justify-content:center; text-align:center; min-height:48vh; padding:22px; background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.25))}
-    .hero-overlay h2{font-size:clamp(28px,4.2vw,48px); line-height:1.05}
-    .hero-overlay p{color:var(--muted); max-width:720px}
-
-    .glass{background:var(--glass); border:1px solid var(--outline); border-radius:18px; padding:14px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
-    .stack{display:grid; gap:12px}
-
-    .controlbar{
-      display:grid; grid-template-columns: 1fr 220px 140px 220px; gap:10px; align-items:end;
-    }
-    @media (max-width:960px){ .controlbar{grid-template-columns:1fr 1fr; grid-auto-rows:auto} }
-    label{font-size:12px; color:var(--muted)}
-    textarea,select,input,button{width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(10,14,22,.65); color:var(--fg)}
-    textarea{min-height:64px; resize:vertical}
-    button{cursor:pointer; background:linear-gradient(90deg, var(--accent), var(--accent2)); font-weight:700; border:none}
-    .btn-secondary{background:rgba(255,255,255,.06); border:1px solid var(--outline)}
-    .btn-success{background:rgba(0,226,123,.14); border-color:var(--ok)}
-    .btn-pulse{animation:pulse 0.9s ease}
-    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(0,226,123,.45)}100%{box-shadow:0 0 0 14px rgba(0,226,123,0)}}
-
-    .meter{height:8px; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden}
-    .meter>i{display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent2))}
-    .tiny{font-size:11px; color:var(--muted)}
-
-    .chat-wrap{position:relative; overflow:hidden; border-radius:16px; border:1px solid var(--outline); background:rgba(4,8,14,.65)}
-    .chat{position:relative; z-index:1; max-height:56vh; overflow:auto; padding:14px; display:grid; gap:8px}
-    .bubble{padding:11px 12px; border-radius:12px; background:rgba(6,10,16,.6); border:1px solid rgba(255,255,255,.1); line-height:1.45; white-space:pre-wrap}
-    .agentA{border-left:3px solid var(--accent)}
-    .agentB{border-left:3px solid var(--good)}
-    .agentC{border-left:3px solid var(--bad)}
-
-    .feed{display:grid; gap:10px}
-    .feed-item{border:1px solid var(--outline); border-radius:14px; padding:12px; background:rgba(255,255,255,.04)}
-    .feed-item h5{margin:0 0 6px 0; font-size:14px}
-    .feed-item small{color:var(--muted)}
-    .feed-tools{display:flex; gap:6px; align-items:center; justify-content:flex-end; margin-top:8px}
-    .feed-details{display:none; margin-top:8px; padding-top:8px; border-top:1px dashed var(--outline); white-space:pre-wrap; font-size:13px; color:#d2def0}
-    .feed-item.open .feed-details{display:block}
-
-    .meet{display:grid; gap:12px}
-    .toast{position:fixed; bottom:16px; left:50%; transform:translateX(-50%); background:rgba(6,10,16,.9); color:var(--fg); border:1px solid var(--outline); padding:10px 14px; border-radius:10px; font-size:13px; display:none}
-    .toast.ok{border-color:var(--ok)}
-    .toast.bad{border-color:var(--bad)}
+    .hero video{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; pointer-events:none; filter:contrast(1.05) saturate(1.1) brightness(.8)}
+    .hero .glass{position:relative; z-index:1; background:linear-gradient(180deg, rgba(13,18,26,.75), rgba(13,18,26,.45)); border-top:1px solid #17202C}
+    .hero .inner{display:grid; grid-template-columns: 1fr; gap:14px; padding:16px}
+    .hero h2{font-size:16px; font-weight:700; color:var(--muted); letter-spacing:.25px}
+    .hero .controls{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
+    .hero input, .hero textarea, .hero select{width:100%; border-radius:12px; border:1px solid #1C2735; background:linear-gradient(180deg, #0F1520, #0C1219); color:var(--text); padding:10px 12px; outline:none; box-shadow:inset 0 0 0 1px rgba(255,255,255,0.03)}
+    .hero textarea{min-height:82px; resize:vertical}
+    .hero .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
+    .btns{display:flex; gap:10px; flex-wrap:wrap}
+    button{border-radius:12px; border:1px solid #243144; background:linear-gradient(180deg, #0F1724, #0B1119); color:var(--text); padding:10px 14px; font-weight:600; cursor:pointer}
+    button:disabled{opacity:.6; cursor:not-allowed}
+    .btn-primary{background:linear-gradient(180deg, #0C1C1B, #0A1313); border-color:#18302E}
+    .btn-success{border-color:#1f3f2c}
+    .btn-pulse{animation:pulse .6s}
+    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(59,224,125,.6)}100%{box-shadow:0 0 0 12px rgba(59,224,125,0)}}
+
+    .progress{height:4px; background:#0E1420; border-radius:999px; overflow:hidden; border:1px solid #1B2533}
+    .progress .bar{height:100%; width:2%; background:linear-gradient(90deg, var(--accent), var(--accent2)); transition:width .15s ease}
+
+    .grid{display:grid; grid-template-columns: 1fr; gap:16px}
+    .cols{display:grid; grid-template-columns: 1fr 1fr; gap:16px}
+    @media (max-width:880px){ .cols{grid-template-columns:1fr} }
+
+    .feed{border:1px solid var(--outline); border-radius:14px; background:linear-gradient(180deg, #0E141D, #0C1218)}
+    .feed .item{padding:12px; border-top:1px solid #131A25}
+    .feed .item:first-child{border-top:none}
+    .feed small{color:var(--muted)}
+    .feed .item h4{margin:0 0 6px; font-size:14px}
+    .feed .item pre{white-space:pre-wrap}
+
+    .chat{display:grid; gap:10px}
+    .bubble{border:1px solid var(--outline); background:linear-gradient(180deg, #0E141D, #0C1218); padding:12px; border-radius:12px; line-height:1.5}
+    .agentA{border-color:#114141; box-shadow:0 0 0 1px rgba(57,229,194,0.08) inset}
+    .agentB{border-color:#332455; box-shadow:0 0 0 1px rgba(176,140,255,0.07) inset}
+    .agentC{border-color:#34405e; box-shadow:0 0 0 1px rgba(105,156,255,0.07) inset}
+
+    .toast{display:none; position:fixed; bottom:14px; left:50%; transform:translateX(-50%);
+      background:linear-gradient(180deg, #10202B, #0B141B); border:1px solid #1C2B39; padding:10px 14px; border-radius:12px}
   </style>
 </head>
 <body>
+<div class="wrap">
   <header>
     <div class="nav">
       <div class="brand">
-        <img src="ParleyLogo.png" alt="Parley Protocol logo" />
+        <img src="ParleyLogo.png" alt="Parley logo" />
         <h1>Parley Protocol</h1>
       </div>
-      <div class="credit">Powered by <a href="https://webllm.mlc.ai/" target="_blank" rel="noopener">WebLLM</a></div>
+      <div class="credit">
+        Built with WebGPU + WebLLM. <a href="https://github.com/" target="_blank" rel="noreferrer">Source</a>
+      </div>
     </div>
   </header>
 
   <main>
-    <div id="wgpuBanner" class="wgpu-warning">
-      ⚠️ Your browser does not support WebGPU. Parley Protocol requires WebGPU to run AI models locally.
-      <a href="https://developer.chrome.com/docs/web-platform/webgpu/#enable-webgpu" target="_blank" rel="noopener">Enable WebGPU</a> (Chrome/Edge 113+).
-    </div>
-
-    <!-- HERO -->
+    <div id="wgpuBanner" class="wgpu-warning">WebGPU not detected. Use Chrome/Edge 113+ and enable it in chrome://flags.</div>
+
     <section class="hero">
-      <video src="Intro sting.mp4" poster="Solana-coded UI background.png" autoplay muted playsinline loop></video>
-      <div class="hero-overlay">
-        <h2>Watch AIs debate the world’s hardest problems</h2>
-        <p>Pose a deep, global question. Then watch 2–3 expert personas debate toward a joint plan — all in your browser, no servers.</p>
-      </div>
-    </section>
-
-    <!-- CONTROLS -->
-    <section class="glass stack">
-      <div class="controlbar">
-        <div>
-          <label>Big Question</label>
-          <textarea id="question" maxlength="500" placeholder="e.g., How do we reduce the risk of great-power conflict while safeguarding smaller nations' sovereignty?"></textarea>
-        </div>
-        <div>
-          <label>Model</label>
-          <select id="model">
+      <video src="Intro sting.mp4" autoplay muted loop playsinline></video>
+      <div class="glass">
+        <div class="inner">
+          <h2>Ask a hard question. Agents will debate and the moderator will synthesize.</h2>
+
+          <div class="controls">
+            <input id="question" placeholder="Your question…" />
+            <select id="turns" title="Turns">
+              <option value="2">2 turns</option>
+              <option value="3">3 turns</option>
+              <option value="4">4 turns</option>
+              <option value="5">5 turns</option>
+            </select>
+          </div>
+
+          <textarea id="goal" placeholder="Optional: state a concrete goal (KPIs, constraints, success metric)"></textarea>
+
+          <div class="row">
+            <select id="model" title="Model">
+            <option value="Qwen2-1.5B-Instruct-q4f32_1-MLC" selected>Qwen2-1.5B-Instruct</option>
+            <option value="Phi-3-mini-4k-instruct-q4f32_1-MLC">Phi-3-Mini-4k-Instruct</option>
             <option value="Llama-3.1-8B-Instruct-q4f32_1-MLC">Llama-3.1-8B-Instruct</option>
-            <option value="Qwen2-1.5B-Instruct-q4f32_1-MLC">Qwen2-1.5B-Instruct</option>
-            <option value="Phi-3-mini-4k-instruct-q4f32_1-MLC">Phi-3-Mini-4k-Instruct</option>
           </select>
-        </div>
-        <div>
-          <label>Turns per agent</label>
-          <input id="turns" type="number" min="1" max="5" value="2">
-        </div>
-        <div style="display:flex; gap:8px;">
-          <button id="loadBtn" title="Load the selected model">Load Model</button>
-          <button id="runBtn" disabled title="Run the multi-agent debate">Run Parley</button>
-        </div>
-      </div>
-
-      <div>
-        <label>Debate Goal / Instructions</label>
-        <input id="goal" type="text" maxlength="300" value="Debate constructively and end with a short, concrete joint plan with 3 actionable steps and named risks.">
-      </div>
-
-      <div class="meter"><i id="meterBar"></i></div>
-      <div class="tiny" id="status">Status: idle</div>
-    </section>
-
-    <!-- CHAT -->
-    <section class="chat-wrap">
-      <div class="chat" id="chat"></div>
-    </section>
-
-    <!-- ACTIONS -->
-    <section class="glass" style="display:flex; gap:8px; justify-content:flex-end;">
-      <button id="postXBtn" class="btn-secondary" title="Post the debate to X" disabled>Post this conversation to X</button>
-      <button id="saveBtn" class="btn-secondary" title="Publish to the Recent Debates feed" disabled>Make this debate public</button>
-    </section>
-
-    <!-- FEED -->
-    <section class="glass">
-      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;gap:10px">
-        <h3 style="margin:0">Recent Debates</h3>
-        <div class="tiny" style="display:flex;align-items:center;gap:10px">
-          <label style="display:flex;align-items:center;gap:6px;cursor:pointer">
-            <input type="checkbox" id="hideLocalToggle" checked />
-            Auto-hide local saves
-          </label>
-          <button id="clearLocalBtn" class="btn-secondary" style="padding:6px 10px">Clear local</button>
-        </div>
-      </div>
-      <div id="feed" class="feed"></div>
-      <div class="tiny">Tip: shared globally via Supabase. Live updates enabled.</div>
-    </section>
-
-    <!-- MEET THE AGENTS -->
-    <section class="glass meet">
-      <img src="Agent archetypes panel.png" alt="AI agent archetypes: Realist Strategist, Humanitarian Diplomat, Data-Driven Technocrat" style="width:100%;border-radius:12px;display:block; margin-bottom:10px">
-      <div class="agents" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px">
-        <div class="agent" style="border:1px solid var(--outline);border-radius:12px;padding:10px;background:rgba(255,255,255,.04)">
-          <h4>Agent A — Realist Strategist</h4>
-          <p class="sys">Deterrence, credible commitments, incremental, verification-heavy policies.</p>
-        </div>
-        <div class="agent" style="border:1px solid var(--outline);border-radius:12px;padding:10px;background:rgba(255,255,255,.04)">
-          <h4>Agent B — Humanitarian Diplomat</h4>
-          <p class="sys">Human rights, corridors, confidence-building, inclusive governance, win-wins.</p>
-        </div>
-        <div class="agent" style="border:1px solid var(--outline);border-radius:12px;padding:10px;background:rgba(255,255,255,.04)">
-          <h4>Agent C — Data-Driven Technocrat</h4>
-          <p class="sys">Mechanism design, KPIs, pilots, incentive alignment, measurable outcomes.</p>
+            <div class="btns">
+              <button id="loadBtn" class="btn-primary">Load model</button>
+              <button id="runBtn" class="btn-primary" disabled>Run debate</button>
+            </div>
+          </div>
+
+          <div class="progress"><div id="meterBar" class="bar"></div></div>
+          <div id="status" aria-live="polite">Idle.</div>
         </div>
       </div>
     </section>
+
+    <section class="cols">
+      <div class="grid">
+        <h3>Debate</h3>
+        <div id="chat" class="chat"></div>
+      </div>
+
+      <div class="grid">
+        <h3>Public Feed</h3>
+        <div class="btns" style="align-items:center;">
+          <label><input type="checkbox" id="hideLocalToggle" /> Hide local-only</label>
+          <button id="clearLocalBtn">Clear local</button>
+          <button id="saveBtn" disabled>Save debate</button>
+          <button id="postXBtn" disabled>Post to X</button>
+        </div>
+        <div id="feed" class="feed"></div>
+      </div>
+    </section>
+
+    <div class="toast" id="toast"></div>
   </main>
-
-  <div id="toast" class="toast"></div>
-
-  <script type="module">
+</div>
+
+<script type="module">
     /* ====== CONFIG ====== */
     const PARLEY_SUPABASE_URL = "https://eqbrwrkkrhjbotccqxis.supabase.co";
-    const PARLEY_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxYnJ3cmtrcmhqYm90Y2NxeGlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMjQwMjMsImV4cCI6MjA3MDYwMDAyM30.63xXq_e0cvALc8W8nA7gFGA7GEKAjXy61tlA7yJvHqQ"; /* <-- paste anon key */
+    const PARLEY_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cC...e0cvALc8W8nA7gFGA7GEKAjXy61tlA7yJvHqQ"; /* <-- paste anon key */
 
     /* Libs */
     const { createClient } = await import('https://esm.run/@supabase/supabase-js@2.45.4');
@@ -242,9 +193,9 @@     const clearLocalBtn=document.getElementById('clearLocalBtn');
 
     /* Personas */
-    const aEl={ value:"You are a Realist Strategist. You value state stability, deterrence, multipolar balance, incrementalism, and credible commitments. Avoid moralizing; emphasize tradeoffs and verification." };
-    const bEl={ value:"You are a Humanitarian Diplomat. You prioritize human rights, humanitarian corridors, international law, confidence-building measures, and inclusive governance. Seek constructive-sum policies." };
-    const cEl={ value:"You are a Data-Driven Technocrat. You lean on causal evidence, mechanism design, incentive alignment, and measurable KPIs. You translate ideals into testable policy pilots." };
+    const aEl={ value:"You are a Realist Strategist. You value s...nts. Avoid moralizing; emphasize tradeoffs and verification." };
+    const bEl={ value:"You are a Humanitarian Diplomat. You prio...s, and inclusive governance. Seek constructive-sum policies." };
+    const cEl={ value:"You are a Data-Driven Technocrat. You lea...able KPIs. You translate ideals into testable policy pilots." };
 
     let engine=null;
     let lastQuestion="", lastSummary="", lastTranscript="", lastPublicId="";
@@ -254,8 +205,8 @@     /* Utils */
     function setStatus(t){ statusEl.textContent=t; }
     function setProgress(p){ meterBar.style.width=`${Math.max(2,Math.floor(p*100))}%`; }
-    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;'}[m])); }
-    function toast(msg, type='ok'){ toastEl.textContent=msg; toastEl.className='toast '+type; toastEl.style.display='block'; setTimeout(()=>toastEl.style.display='none',2500); }
+    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;'}[m])); }
+    function toast(msg, type='ok'){ toastEl.textContent=msg; toastEl.style.display='block'; setTimeout(()=>toastEl.style.display='none',2500); }
     function uid(){ return Math.random().toString(36).slice(2) + Date.now().toString(36); }
     function isUUID(id){ return /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(id||''); }
 
@@ -278,59 +229,27 @@       return blocks;
     }
 
-    /* Local feed with de-dupe */
-    function loadLocalFeed(){ try{ return JSON.parse(localStorage.getItem('parleyFeed')||'[]'); } catch{ return []; } }
-    function saveLocalFeed(item){
-      const arr=loadLocalFeed().filter(x => x.id !== item.id);
-      arr.unshift(item);
-      localStorage.setItem('parleyFeed', JSON.stringify(arr.slice(0,100)));
-    }
-    function getLocalById(id){ return loadLocalFeed().find(x=>x.id===id); }
-
-    /* Button success flash */
-    function buttonFlashSuccess(btn, label="Copied ✓"){
-      const prev = btn.textContent;
-      btn.textContent = label;
-      btn.classList.add('btn-success','btn-pulse');
-      setTimeout(()=>{ btn.textContent=prev; btn.classList.remove('btn-success','btn-pulse'); }, 1000);
-    }
-
-    /* Feed UI */
+    /* Feed UI (unchanged core) */
     function renderFeed(items){
-      feedEl.innerHTML='';
-      if(!items.length){ feedEl.innerHTML='<div class="tiny">No debates yet.</div>'; return; }
-      for(const it of items){
-        const card=document.createElement('div');
-        card.className='feed-item';
-        card.innerHTML=`
-          <h5>${escapeHtml(it.question)}</h5>
-          <div class="tiny" style="margin-bottom:6px">${new Date(it.created_at||Date.now()).toLocaleString()}</div>
-          <div class="feed-tools">
-            <button class="btn-secondary" data-expand="${it.id}">Expand</button>
-            <button class="btn-secondary" data-copy="${it.id}">Copy link</button>
-            <button class="btn-secondary" data-post="${it.id}">Post to X</button>
+      const rows = items.map(it=>{
+        const id = it.id;
+        const date = new Date(it.created_at || Date.now()).toLocaleString();
+        const question = escapeHtml(it.question||'');
+        const summary = escapeHtml(it.summary||'');
+        const isPublic = isUUID(id);
+        return `
+          <div class="item">
+            <h4>${question} <small>— ${date}</small></h4>
+            <pre>${summary}</pre>
+            <div class="btns">
+              <button data-copy="${id}">Copy link</button>
+              ${isPublic? `<button data-post="${id}">Post to X</button>`:``}
+            </div>
           </div>
-          <div class="feed-details" id="details_${it.id}"></div>
         `;
-        feedEl.appendChild(card);
-      }
-      feedEl.querySelectorAll('[data-expand]').forEach(btn=>{
-        btn.addEventListener('click', async (e)=>{
-          const id=e.currentTarget.getAttribute('data-expand');
-          const container=e.currentTarget.closest('.feed-item');
-          const panel=document.getElementById('details_'+id);
-          if(!panel.dataset.hydrated){
-            const data=await fetchById(id);
-            if(data){
-              const summary = data.summary ? `**Joint Plan**\n${data.summary}\n\n` : '';
-              panel.textContent = summary + (data.transcript || '');
-              panel.dataset.hydrated='1';
-            }
-          }
-          container.classList.toggle('open');
-          e.currentTarget.textContent = container.classList.contains('open') ? 'Collapse' : 'Expand';
-        });
-      });
+      }).join('');
+      feedEl.innerHTML = rows || '<div class="item"><small>No debates yet.</small></div>';
+
       feedEl.querySelectorAll('[data-copy]').forEach(btn=>{
         btn.addEventListener('click', async (e)=>{
           const id=e.currentTarget.getAttribute('data-copy');
@@ -364,34 +283,21 @@       const { data, error } = await supabase
         .from('debates')
         .insert(item)
-        .select()
+        .select('id')
         .single();
-      if(error){
-        if(error.code === '23505'){ // unique violation
-          const { data:dup } = await supabase
-            .from('debates')
-            .select('id,question,summary,transcript,created_at')
-            .eq('question', item.question)
-            .order('created_at', { ascending:false })
-            .limit(1)
-            .maybeSingle();
-          return dup || null;
-        }
-        console.warn(error); toast('Public save failed (RLS/Key?)','bad'); return null;
-      }
+      if(error){ console.warn(error); return null; }
       return data;
     }
     async function fetchById(id){
+      if(!id) return null;
       if(isUUID(id) && supabase){
-        const { data, error } = await supabase
-          .from('debates')
-          .select('id,question,summary,transcript,created_at')
-          .eq('id', id)
-          .maybeSingle();
-        if(!error && data) return data;
+        const { data, error } = await supabase.from('debates').select('id,question,summary,transcript,created_at').eq('id', id).single();
+        if(error){ console.warn(error); return null; }
+        return data;
       }
       return getLocalById(id);
     }
+
     async function refreshFeed(){
       const local=loadLocalFeed();
       const remote=await fetchPublicFeed();
@@ -400,14 +306,12 @@       renderFeed(merged);
     }
 
-    /* Realtime updates */
     if(supabase){
       supabase.channel('public:debates')
         .on('postgres_changes', { event:'INSERT', schema:'public', table:'debates' }, () => refreshFeed())
         .subscribe();
     }
 
-    /* Permalinks + tweets */
     function permalinkForId(id){
       const url=new URL(location.href);
       url.search='?id='+encodeURIComponent(id);
@@ -415,17 +319,55 @@       return url.toString();
     }
     function buildTweetText(question, link){
-      const CTA = "View this debate:";
-      const HASHTAG = " #ParleyProtocol";
-      const reserve = CTA.length + 1 + 23 + HASHTAG.length + 2;
-      const MAXQ = Math.max(0, 280 - reserve - 2);
-      let q = (question||"").trim().replace(/\s+/g,' ');
-      if(q.length > MAXQ) q = q.slice(0, MAXQ - 1) + "…";
-      return `“${q}”\n${CTA} ${link}${HASHTAG}`;
-    }
-
-    /* WebLLM */
+      const t = `Parley Protocol — “${(question||'').slice(0,120)}”\\n\\n` + link;
+      return t;
+    }
+
+    /* Local feed storage */
+    function loadLocalFeed(){
+      try{ return JSON.parse(localStorage.getItem('parleyFeed')||'[]'); }catch{ return []; }
+    }
+    function saveLocalFeed(item){
+      const arr=loadLocalFeed();
+      arr.unshift(item);
+      localStorage.setItem('parleyFeed', JSON.stringify(arr.slice(0,100)));
+    }
+    function getLocalById(id){ return loadLocalFeed().find(x=>x.id===id); }
+
+    /* Button success flash */
+    function buttonFlashSuccess(btn, label="Copied ✓"){
+      const prev = btn.textContent;
+      btn.textContent = label;
+      btn.classList.add('btn-success','btn-pulse');
+      setTimeout(()=>{ btn.textContent=prev; btn.classList.remove('btn-success','btn-pulse'); }, 1000);
+    }
+
+    /* Model prompts */
+    function buildPrompt(rolePrompt,userQ,goal){
+      return [
+        { role:'system', content:`${rolePrompt}\\nGoal: ${goal}` },
+        { role:'user', content:`Question: ${userQ}\\nRespond concisely in 5–8 sentences.` }
+      ];
+    }
+    function rebuttalPrompt(rolePrompt, transcript, goal){
+      return [
+        { role:'system', content:`${rolePrompt}\\nGoal: ${goal}` },
+        { role:'user', content:`Transcript so far:\\n${transcript}\\nWrite your next turn with specifics and a concrete proposal.` }
+      ];
+    }
+    function synthPrompt(transcript){
+      return [
+        { role:'system', content:'You are the Moderator. Synthesize agreement/tension into a realistic plan.' },
+        { role:'user', content:`Create a final outcome based on the full debate. Structure:
+1) Joint Plan: concise bullet list with concrete actions, owners, timelines, measurable KPIs.
+2) Risks & Mitigations: bullets + mitigations.
+3) Open Question: one unresolved issue.` }
+      ];
+    }
+
+    /* WebLLM: loader (with WebGPU warm-up) */
     async function loadModel(){
+      try{ const adapter = await navigator.gpu?.requestAdapter?.({powerPreference:'high-performance'}); await adapter?.requestDevice?.(); }catch(e){}
       setStatus('Importing WebLLM…');
       loadBtn.disabled=true;
       try{
@@ -443,32 +385,27 @@         loadBtn.disabled=false;
       }
     }
+
+    /* Generators */
     async function generate(messages){
-      const chunks=await engine.chat.completions.create({messages,stream:true,temperature:0.9});
+      // legacy: buffered generation (fallback)
+      const chunks=await engine.chat.completions.create({messages,stream:true,temperature:0.8,max_tokens:220});
+      let reply=''; for await(const ch of chunks){ reply += ch.choices?.[0]?.delta?.content || ''; }
+      return reply.trim();
+    }
+    async function generateStreaming(messages, targetDiv, {temperature=0.8, max_tokens=220}={}){
+      const chunks=await engine.chat.completions.create({messages,stream:true,temperature,max_tokens});
       let reply='';
-      for await(const ch of chunks){ reply += ch.choices?.[0]?.delta?.content || ''; }
+      for await(const ch of chunks){
+        const piece = ch.choices?.[0]?.delta?.content || '';
+        if(!piece) continue;
+        reply += piece;
+        if(targetDiv){ targetDiv.textContent = reply; targetDiv.scrollIntoView({block:'end'}); }
+      }
       return reply.trim();
     }
-    function buildPrompt(rolePrompt,userQ,goal){
-      return [
-        { role:'system', content:`${rolePrompt}\nGoal: ${goal}` },
-        { role:'user', content:`Question: ${userQ}\nRespond concisely in 5–8 sentences.` }
-      ];
-    }
-    function rebuttalPrompt(rolePrompt, transcript, goal){
-      return [
-        { role:'system', content:`${rolePrompt}\nGoal: ${goal}` },
-        { role:'user', content:`Transcript so far:\n${transcript}\nWrite your next turn with specifics and a concrete proposal.` }
-      ];
-    }
-    function synthPrompt(transcript){
-      return [
-        { role:'system', content:'You are the Moderator. Synthesize agreement/tension into a realistic plan.' },
-        { role:'user', content:`Create a final outcome based on this debate:\n${transcript}\nOutput:\n1) Joint Plan: three concrete steps.\n2) Risks: two bullets + mitigations.\n3) Open Question: one unresolved issue.` }
-      ];
-    }
-
-    /* Run debate */
+
+    /* Run debate (streaming + parallel per round) */
     async function runParley(){
       if(!engine) return alert('Load a model first.');
       chatEl.innerHTML='';
@@ -487,25 +424,33 @@ 
       let transcript='';
 
+      // Opening statements in parallel, streaming to UI
       setStatus('Generating opening statements…');
-      for(const [tag,prompt] of personas){
-        const msg=await generate(buildPrompt(prompt,q,goal));
-        transcript+=`\n\n[${tag}] ${msg}`;
-        const div=document.createElement('div'); div.className='bubble agent'+tag; div.textContent=msg; chatEl.appendChild(div);
-      }
-
+      {
+        const jobs = personas.map(([tag,prompt])=>{
+          const div=document.createElement('div'); div.className='bubble agent'+tag; chatEl.appendChild(div);
+          return generateStreaming(buildPrompt(prompt,q,goal), div, {max_tokens:220, temperature:0.8}).then(msg=>({tag,msg}));
+        });
+        const results = await Promise.all(jobs);
+        for(const {tag,msg} of results){ transcript += `\n\n[${tag}] ${msg}`; }
+      }
+
+      // Debate rounds with parallel agent turns per round
       setStatus('Running debate…');
       for(let t=0; t<turns-1; t++){
-        for(const [tag,prompt] of personas){
-          const msg=await generate(rebuttalPrompt(prompt, transcript.slice(-4000), goal));
-          transcript+=`\n\n[${tag}] ${msg}`;
-          const div=document.createElement('div'); div.className='bubble agent'+tag; div.textContent=msg; chatEl.appendChild(div);
-        }
-      }
-
+        const snap = transcript.slice(-3000);
+        const jobs = personas.map(([tag,prompt])=>{
+          const div=document.createElement('div'); div.className='bubble agent'+tag; chatEl.appendChild(div);
+          return generateStreaming(rebuttalPrompt(prompt, snap, goal), div, {max_tokens:220, temperature:0.8}).then(msg=>({tag,msg}));
+        });
+        const results = await Promise.all(jobs);
+        for(const {tag,msg} of results){ transcript += `\n\n[${tag}] ${msg}`; }
+      }
+
+      // Moderator synthesis (slightly higher cap)
       setStatus('Synthesizing…');
-      const mod=await generate(synthPrompt(transcript.slice(-6000)));
-      const divM=document.createElement('div'); divM.className='bubble'; divM.textContent=mod; chatEl.appendChild(divM);
+      const divM=document.createElement('div'); divM.className='bubble'; chatEl.appendChild(divM);
+      const mod=await generateStreaming(synthPrompt(transcript.slice(-4500)), divM, {max_tokens:280, temperature:0.8});
       setStatus('Done.');
 
       lastQuestion=q;
@@ -538,9 +483,16 @@         return;
       }
 
-      const item={ question:lastQuestion.slice(0,500), summary:lastSummary.slice(0,1200), transcript:lastTranscript.slice(0,20000), created_at:new Date().toISOString() };
-      const localId = uid();
-      saveLocalFeed({ id:localId, ...item });
+      const item = {
+        id: uid(),
+        question: lastQuestion,
+        summary: lastSummary,
+        transcript: lastTranscript,
+        created_at: new Date().toISOString()
+      };
+
+      const localId = item.id;
+      saveLocalFeed(item);
 
       let remote=null;
       if(supabase){ remote = await savePublic(item); }
@@ -574,7 +526,7 @@           const blocks = parseTranscriptBlocks(data.transcript);
           for(const b of blocks){
             const div=document.createElement('div');
-            div.className='bubble ' + (b.role==='Moderator' ? '' : ('agent'+b.role));
+            div.className = 'bubble' + (b.role==='A'?' agentA': b.role==='B'?' agentB': b.role==='C'?' agentC':'');
             div.textContent=b.text;
             chatEl.appendChild(div);
           }
@@ -589,6 +541,6 @@     /* Wire up buttons */
     loadBtn.addEventListener('click', loadModel);
     runBtn.addEventListener('click', runParley);
-  </script>
+</script>
 </body>
 </html>
