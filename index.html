<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parley Protocol — Multi‑Agent LLM Debates on Solana Vibes</title>
  <meta name="description" content="A sleek, futuristic demo where multiple local LLMs debate deep questions in your browser via WebGPU (WebLLM)." />
  <link rel="preconnect" href="https://esm.run" />
  <style>
    :root{
      --bg:#05070c; --fg:#e6f1ff; --muted:#9bb0c8; --glass:rgba(255,255,255,.06);
      --accent:#00e5ff; --accent2:#7c4dff; --good:#00e27b; --warn:#ffd166; --bad:#ff5c8a;
      --outline:rgba(255,255,255,.1);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%}
    body{
      font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Arial;
      background: radial-gradient(1200px 600px at 80% -10%, #0a1b27 0%, transparent 60%),
                  radial-gradient(1000px 500px at -10% 0%, #0f0a2b 0%, transparent 60%),
                  linear-gradient(180deg, #04060a 0%, #02040a 60%, #020208 100%);
      color:var(--fg);
      overflow-x:hidden;
    }
    /* Subtle moving gridlines for depth */
    body:before{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
      background:
        repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 1px, transparent 1px 160px),
        repeating-linear-gradient(0deg,  rgba(255,255,255,.03) 0 1px, transparent 1px 160px);
      mask-image:radial-gradient(900px 900px at 70% -10%, rgba(255,255,255,.9) 0%, transparent 60%);
      animation: drift 22s linear infinite;
    }
    @keyframes drift{0%{transform:translateY(0)}100%{transform:translateY(30px)}}

    header{
      position:sticky;top:0;z-index:20;backdrop-filter:saturate(140%) blur(10px);
      background:linear-gradient(180deg, rgba(10,14,20,.9), rgba(10,14,20,.6));
      border-bottom:1px solid var(--outline);
    }
    .nav{width:min(1200px,92vw);margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 0}
    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{font-size:18px;font-weight:800;letter-spacing:.2px}
    .credit{font-size:12px;color:var(--muted)}

    main{position:relative;z-index:1;width:min(1100px,92vw);margin:0 auto;padding:28px 0 84px;display:grid;gap:22px}

    /* Hero */
    .hero{position:relative;overflow:hidden;min-height:64vh;border-radius:18px;border:1px solid var(--outline)}
    .hero video,.hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;pointer-events:none;filter:contrast(1.08) saturate(1.05) brightness(.9)}
    .hero-overlay{position:relative;z-index:2;display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;text-align:center;min-height:64vh;padding:28px;background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.25))}
    .hero-overlay h2{font-size:clamp(30px,4.6vw,56px);line-height:1.05}
    .hero-overlay p{color:var(--muted);max-width:720px}

    .glass{background:var(--glass);border:1px solid var(--outline);border-radius:18px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .stack{display:grid;gap:14px}
    .row{display:flex;gap:12px;flex-wrap:wrap}

    label{font-size:12px;color:var(--muted)}
    textarea,select,input,button{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(10,14,22,.65);color:var(--fg)}
    textarea{min-height:92px;resize:vertical}
    button{cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent2));font-weight:700;border:none}

    .agents{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .agent{background:rgba(255,255,255,.04);padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.1)}
    .agent h4{margin-bottom:6px}
    .sys{font-size:12px;color:var(--muted)}

    .meter{height:10px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .meter>i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
    .tiny{font-size:11px;color:var(--muted)}

    /* Chat */
    .chat-wrap{position:relative;overflow:hidden;border-radius:16px;border:1px solid var(--outline)}
    .chat-bg video,.chat-bg img{width:100%;height:100%;object-fit:cover;filter:blur(1px) brightness(.85);pointer-events:none}
    .chat{position:relative;z-index:1;max-height:56vh;overflow:auto;padding:16px;display:grid;gap:10px;background:linear-gradient(180deg, rgba(3,6,12,.78), rgba(3,6,12,.6))}
    .bubble{padding:12px 14px;border-radius:12px;background:rgba(6,10,16,.6);border:1px solid rgba(255,255,255,.1);line-height:1.45}
    .agentA{border-left:3px solid var(--accent)}
    .agentB{border-left:3px solid var(--good)}
    .agentC{border-left:3px solid var(--bad)}

    /* WebGPU banner */
    .wgpu-warning{display:none;background:rgba(255,92,138,0.12);border:1px solid var(--bad);color:var(--bad);padding:10px;border-radius:10px;font-size:14px}
    .wgpu-warning a{color:var(--bad);text-decoration:underline}

    /* Logo SVG sizing */
    .logo-wrap{display:flex;align-items:center;gap:10px}
    .logo-svg{width:30px;height:30px;display:block}

    @media (max-width:640px){
      .chat{max-height:50vh}
      .hero{min-height:54vh}
    }
  </style>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand logo-wrap">
      <!-- Inline SVG logo -->
      <svg class="logo-svg" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs>
          <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0%" stop-color="#00e5ff"/>
            <stop offset="100%" stop-color="#7c4dff"/>
          </linearGradient>
        </defs>
        <rect x="6" y="6" width="52" height="52" rx="14" fill="url(#g)" opacity=".35"/>
        <path d="M20 24h24v4H20zm0 12h24v4H20z" fill="url(#g)"/>
        <circle cx="16" cy="26" r="3" fill="#00e5ff"/>
        <circle cx="16" cy="38" r="3" fill="#7c4dff"/>
      </svg>
      <h1>Parley Protocol</h1>
    </div>
    <div class="credit">Powered by <a href="https://webllm.mlc.ai/" target="_blank" style="color:var(--accent)">WebLLM</a></div>
  </div>
</header>
<main>
  <div id="wgpuBanner" class="wgpu-warning">
    ⚠️ Your browser does not support WebGPU. Parley Protocol requires WebGPU to run AI models locally.
    <a href="https://developer.chrome.com/docs/web-platform/webgpu/#enable-webgpu" target="_blank">Enable WebGPU</a> (Chrome/Edge 113+).
  </div>

  <!-- HERO -->
  <section class="hero">
    <video src="Intro sting.mp4" poster="Solana-coded UI background.png" autoplay muted playsinline loop></video>
    <div class="hero-overlay">
      <h2>Watch AIs debate the world’s hardest problems</h2>
      <p>Pose a deep, global question. Then watch 2–3 expert personas debate toward a joint plan — all in your browser, no servers.</p>
    </div>
  </section>

  <!-- CONTROLS -->
  <section class="glass stack">
    <div class="row" style="align-items:flex-start">
      <div style="flex:2 1 420px">
        <label>Big Question</label>
        <textarea id="question" placeholder="e.g., How do we reduce the risk of great‑power conflict while safeguarding smaller nations' sovereignty?"></textarea>
      </div>
      <div style="flex:1 1 260px">
        <label>Model (browser‑local)</label>
        <select id="model">
          <option value="Llama-3.1-8B-Instruct-q4f32_1-MLC">Llama‑3.1‑8B‑Instruct</option>
          <option value="Qwen2-1.5B-Instruct-q4f32_1-MLC">Qwen2‑1.5B‑Instruct</option>
          <option value="Phi-3-mini-4k-instruct-q4f32_1-MLC">Phi‑3‑Mini‑4k‑Instruct</option>
        </select>
      </div>
    </div>

    <div class="glass" style="margin-top:6px">
      <img src="Agent archetypes panel.png" alt="AI agent archetypes" style="width:100%;border-radius:12px;display:block">
    </div>

    <div class="agents">
      <div class="agent">
        <h4>Agent A — Realist Strategist</h4>
        <textarea id="a" class="sys">You are a Realist Strategist. You value state stability, deterrence, multipolar balance, incrementalism, and credible commitments. Avoid moralizing; emphasize tradeoffs and verification.</textarea>
      </div>
      <div class="agent">
        <h4>Agent B — Humanitarian Diplomat</h4>
        <textarea id="b" class="sys">You are a Humanitarian Diplomat. You prioritize human rights, humanitarian corridors, international law, confidence‑building measures, and inclusive governance. Seek constructive‑sum policies.</textarea>
      </div>
      <div class="agent">
        <h4>Agent C — Data‑Driven Technocrat</h4>
        <textarea id="c" class="sys">You are a Data‑Driven Technocrat. You lean on causal evidence, mechanism design, incentive alignment, and measurable KPIs. You translate ideals into testable policy pilots.</textarea>
      </div>
    </div>

    <div class="row">
      <div style="flex:1 1 160px">
        <label>Turns per agent</label>
        <input id="turns" type="number" value="2">
      </div>
      <div style="flex:2 1 320px">
        <label>Debate Goal / Instructions</label>
        <input id="goal" type="text" value="Debate constructively and end with a short, concrete joint plan with 3 actionable steps and named risks.">
      </div>
      <div style="flex:1 1 220px; align-self:flex-end; display:flex; gap:10px; width:100%">
        <button id="loadBtn">Load Model</button>
        <button id="runBtn" disabled>Run Parley</button>
      </div>
    </div>

    <div class="meter"><i id="meterBar"></i></div>
    <div class="tiny" id="status">Status: idle</div>
  </section>

  <!-- CHAT -->
  <section class="chat-wrap">
    <div class="chat-bg">
      <video src="Background loop for chat area.mp4" poster="Neon debate chamber.png" autoplay muted playsinline loop></video>
    </div>
    <div class="chat" id="chat"></div>
  </section>
</main>

<script type="module">
  const statusEl=document.getElementById('status');
  const meterBar=document.getElementById('meterBar');
  const runBtn=document.getElementById('runBtn');
  const loadBtn=document.getElementById('loadBtn');
  const chatEl=document.getElementById('chat');
  const questionEl=document.getElementById('question');
  const turnsEl=document.getElementById('turns');
  const goalEl=document.getElementById('goal');
  const modelEl=document.getElementById('model');
  const aEl=document.getElementById('a');
  const bEl=document.getElementById('b');
  const cEl=document.getElementById('c');
  const wgpuBanner=document.getElementById('wgpuBanner');
  let engine=null;

  if(!('gpu' in navigator)) wgpuBanner.style.display = 'block';

  function logBubble(role,text){
    const div=document.createElement('div');
    div.className=`bubble agent${role}`;
    div.textContent=text;
    chatEl.appendChild(div);
    chatEl.scrollTop=chatEl.scrollHeight;
  }
  function setStatus(t){statusEl.textContent=t}
  function setProgress(p){meterBar.style.width=`${Math.max(2,Math.floor(p*100))}%`}

  async function loadModel(){
    setStatus('Importing WebLLM…');
    loadBtn.disabled=true;
    try{
      const webllm=await import('https://esm.run/@mlc-ai/web-llm');
      setStatus(`Loading model: ${modelEl.value}`);
      engine=await webllm.CreateMLCEngine(modelEl.value,{
        initProgressCallback: (p)=>{ setProgress(p.progress||0); setStatus(`Loading: ${Math.round((p.progress||0)*100)}% — ${p.text||''}`) }
      });
      runBtn.disabled=false; setStatus('Model ready.'); setProgress(1);
    }catch(e){
      console.error(e);
      setStatus('Failed to load. Enable WebGPU (Chrome/Edge 113+).');
      loadBtn.disabled=false;
    }
  }

  async function generate(messages){
    const chunks=await engine.chat.completions.create({messages,stream:true,temperature:0.9});
    let reply='';
    for await(const ch of chunks){ reply+=ch.choices?.[0]?.delta?.content||''; }
    return reply.trim();
  }

  function buildPrompt(rolePrompt,userQ,goal){
    return [
      { role:'system', content:`${rolePrompt}
Goal: ${goal}` },
      { role:'user', content:`Question: ${userQ}
Respond concisely in 5–8 sentences.` }
    ];
  }

  function rebuttalPrompt(rolePrompt, transcript, goal){
    return [
      { role:'system', content:`${rolePrompt}
Goal: ${goal}` },
      { role:'user', content:`Transcript so far:
${transcript}
Write your next turn with specifics and a concrete proposal.` }
    ];
  }

  async function runParley(){
    if(!engine) return alert('Load a model first.');
    chatEl.innerHTML='';

    const q=questionEl.value.trim()||'How can rival blocs deescalate tensions while protecting small states\' sovereignty and trade resilience?';
    const turns=Math.max(1, parseInt(turnsEl.value||'2',10));
    const goal=goalEl.value.trim();

    const personas=[];
    if(aEl.value.trim()) personas.push(['A', aEl.value.trim()]);
    if(bEl.value.trim()) personas.push(['B', bEl.value.trim()]);
    if(cEl.value.trim()) personas.push(['C', cEl.value.trim()]);
    if(personas.length<2) return alert('Please keep at least two agents.');

    let transcript='';

    setStatus('Generating opening statements…');
    for(const [tag,prompt] of personas){
      const msg=await generate(buildPrompt(prompt,q,goal));
      transcript+=`

[${tag}] ${msg}`;
      logBubble(tag,msg);
    }

    setStatus('Running debate…');
    for(let t=0;t<turns-1;t++){
      for(const [tag,prompt] of personas){
        const msg=await generate(rebuttalPrompt(prompt, transcript.slice(-4000), goal));
        transcript+=`

[${tag}] ${msg}`;
        logBubble(tag,msg);
      }
    }

    setStatus('Synthesizing…');
    const mod=await generate([
      { role:'system', content:'You are the Moderator. Synthesize agreement/tension into a realistic plan.' },
      { role:'user', content:`Create a final outcome based on this debate:
${transcript}
Output:
1) Joint Plan: three concrete steps.
2) Risks: two bullets + mitigations.
3) Open Question: one unresolved issue.` }
    ]);
    logBubble('Moderator',mod);
    setStatus('Done.');
  }

  loadBtn.addEventListener('click',loadModel);
  runBtn.addEventListener('click',runParley);
</script>
</body>
</html>
